# October 2024 - Week 2
# Channel: #programming
# Messages: 282

[2024-10-09 15:46] reulen: Im trying to learn c++, im in the middle of the chernos series, what should I do after completing his series?

[2024-10-09 15:47] Brit: the only way to learn is to build things

[2024-10-09 15:48] snowua: Write a project where you will actually be able to practice what you learned

[2024-10-09 15:48] snowua: Watching tutorials will not teach you the language

[2024-10-09 15:52] 0x208D9: [replying to reulen: "Im trying to learn c++, im in the middle of the ch..."]
i actually learnt by writing c and decompiling those to learn how the compiler behaves

[2024-10-09 15:52] 0x208D9: that way i learn various things which might not be particularly useful for prod dev but is hugely a boost while reversing

[2024-10-09 15:57] reulen: [replying to snowua: "Write a project where you will actually be able to..."]
Is there any website that has lists of project ideas?

[2024-10-09 15:59] Brit: do not make yet another calculator, make something you're interested in

[2024-10-09 16:00] luci4: I learned the most building things I actually wanted to use

[2024-10-09 16:06] donnaðŸ¤¯: [replying to reulen: "Is there any website that has lists of project ide..."]
Do you have any specific interests? For example when i started programming i was really into stocks so I wrote a simple stock trading bot

[2024-10-09 16:07] donnaðŸ¤¯: building something around a topic that interests you keeps you motivated as you learn

[2024-10-09 16:08] reulen: Well im not really that far so I cant do most of the things im interested in

[2024-10-09 16:08] donnaðŸ¤¯: As for a list of project ideas heres a start: https://github.com/codecrafters-io/build-your-own-x
[Embed: GitHub - codecrafters-io/build-your-own-x: Master programming by re...]
Master programming by recreating your favorite technologies from scratch. - codecrafters-io/build-your-own-x

[2024-10-09 16:08] donnaðŸ¤¯: [replying to reulen: "Well im not really that far so I cant do most of t..."]
You will never be ready - I personally think its good to just jump in the deep end

[2024-10-09 16:09] donnaðŸ¤¯: what are some interests you have? maybe I can bouce some ideas off you

[2024-10-09 16:12] reulen: Mostly game hacking

[2024-10-09 16:14] donnaðŸ¤¯: [replying to reulen: "Mostly game hacking"]
Id probably just start watching a few of the tutorials on youtube can link you some if youd like but they arent hard to find

[2024-10-09 16:15] reulen: [replying to donnaðŸ¤¯: "Id probably just start watching a few of the tutor..."]
If you can then link them please

[2024-10-09 16:15] koyz: and, if not done already, read the rules

[2024-10-09 16:29] Torph: [replying to reulen: "Im trying to learn c++, im in the middle of the ch..."]
I learned by just going off and writing something. at the time I wanted to automate some in-memory hex editing for game modding, so I wrote something that would edit the memory of a game while it was running. what interests you is probably different, but just try to think of something small you want to do that's not easy with the tools you have right now.

[2024-10-09 16:31] Torph: (as per <#835634425995853834> that wasn't a game cheating thing, it's just that you could get instant feedback on changes by editing in-memory instead of rebooting the game)

[2024-10-09 17:08] dinero: surely this is satire? :)

[2024-10-09 17:14] Timmy: don't use conan or vcpkg

[2024-10-09 17:14] Timmy: too many horror stories

[2024-10-09 17:14] Timmy: fair

[2024-10-09 17:14] Timmy: fetchContent all the way

[2024-10-09 17:15] dinero: jesus christ

[2024-10-09 17:15] Timmy: completely fair

[2024-10-09 17:17] dinero: he just wants to hack in games

[2024-10-09 17:17] dinero: just use visual studio man

[2024-10-09 17:17] dinero: all this other shit is slop

[2024-10-09 17:17] dinero: lets get real

[2024-10-09 17:17] donnaðŸ¤¯: visual studio ðŸ˜‹

[2024-10-09 17:18] dinero: gotta start somehwere

[2024-10-09 17:18] dinero: pasting win32 crap together is better then 500 calculator apps

[2024-10-09 17:19] dinero: sad but true

[2024-10-09 17:22] rin: What's wrong with learning game hacking.

[2024-10-09 17:26] contificate: write a compiler

[2024-10-09 17:32] contificate: oh

[2024-10-09 17:32] Deleted User: [replying to Timmy: "fetchContent all the way"]
so true

[2024-10-09 18:05] dinero: kek

[2024-10-09 18:06] dinero: doesnt mean it's  untrue!

[2024-10-09 18:18] snowua: [replying to contificate: "write a compiler"]
true

[2024-10-09 18:18] Brit: I'd rather work with the dude who's pasted some win32 shit together than the autist on his 33rd calculator

[2024-10-09 18:18] Deleted User: man but this one

[2024-10-09 18:18] Deleted User: this one is special

[2024-10-09 18:20] contificate: what kind of calculator

[2024-10-09 18:21] Brit: expression evaluation kind

[2024-10-09 18:22] Brit: with support for basic operations

[2024-10-09 18:22] Brit: :^)

[2024-10-09 18:23] contificate: but does he parse expressions

[2024-10-09 18:36] å†°: x = input_number(); while (true) { x = calculate(x, input_operator(), input_number()) }

[2024-10-09 18:38] contificate: clown shoes

[2024-10-09 19:20] dinero: push pop pemdas

[2024-10-09 19:20] dinero: type shit.

[2024-10-09 19:21] Brit: just add more stacks

[2024-10-09 19:54] contificate: just watch a pratt parsing video on youtube

[2024-10-09 19:55] contificate: I hear that this guy knows what he's talking about, seems kinda cute as well https://youtu.be/2l1Si4gSb9A
[Embed: Pratt Parsing]
This video aims to explain the core ideas underpinning top-down operator precedence parsing (or "Pratt Parsing", after its inventor - Vaughan Pratt).

Using a visualisation tool that I created, I hope

[2024-10-09 19:58] Brit: what is it with these british twinks and computers

[2024-10-09 19:59] 5pider: hello hehe

[2024-10-09 20:39] mrexodia: [replying to 5pider: "hello hehe"]
not even british

[2024-10-09 20:40] 5pider: ðŸ˜—

[2024-10-10 00:31] 0x208D9: [replying to Brit: "I'd rather work with the dude who's pasted some wi..."]
"""
HMODULE rpcstuff = LoadLibrary(L"rpcrt4.dll")
"""

[2024-10-10 00:34] 0x208D9: tbf get the best of both worlds at: https://github.com/microsoft/calculator
[Embed: GitHub - microsoft/calculator: Windows Calculator: A simple yet pow...]
Windows Calculator: A simple yet powerful calculator that ships with Windows - microsoft/calculator

[2024-10-10 00:42] Matti: [replying to 0x208D9: "tbf get the best of both worlds at: https://github..."]
have to strongly disagree tbh, it *would* be the best if they had open sourced the windows 8.1 calc.exe instead
[Attachments: image.png]

[2024-10-10 00:43] Matti: now I've had to take this and patch it instead just to add bare minimum QoL features such as starting in hexadecimal mode

[2024-10-10 00:44] Matti: but, the user interface is at least sane

[2024-10-10 00:44] Matti: it's like cmd.exe vs windows terminal

[2024-10-10 00:45] Matti: cmd.exe is just faster and simpler

[2024-10-10 00:45] Matti: terminal is a poor clone of any unix shell, but slower

[2024-10-10 01:03] 0x208D9: [replying to Matti: "have to strongly disagree tbh, it *would* be the b..."]
use the branch then : https://github.com/microsoft/calculator/tree/qualtimi/AeroUpdate

it belongs to the same codebase afaik, just gotta play around with the branches to get the right one ig?
[Embed: GitHub - microsoft/calculator at qualtimi/AeroUpdate]
Windows Calculator: A simple yet powerful calculator that ships with Windows - GitHub - microsoft/calculator at qualtimi/AeroUpdate

[2024-10-10 01:05] 0x208D9: there are also release/2005 and release/2009 ðŸ¥¸

[2024-10-10 01:09] Matti: I also strongly dislike aero <:harold:704245193016344596>

[2024-10-10 01:09] Matti: both of those look like the same app to me tbh

[2024-10-10 01:10] Matti: huge buttons, but not a lot to see

[2024-10-10 01:10] Matti: calc.exe isn't the only app I have this gripe with FWIW

[2024-10-10 01:10] 0x208D9: [replying to Matti: "both of those look like the same app to me tbh"]
the images are the same but the ui was different back when i compiled the aeroupdate atleast

[2024-10-10 01:10] Matti: I do the same for mspaint, the snipping tool and a bunch of others

[2024-10-10 01:11] 0x208D9: [replying to Matti: "I do the same for mspaint, the snipping tool and a..."]
UWP is cancer but well life

[2024-10-10 01:11] Matti: alright, well I do still strongly dislike aero
but I'll give it a try

[2024-10-10 01:11] 0x208D9: [replying to Matti: "alright, well I do still strongly dislike aero
but..."]
pick the release/2012 in that case

[2024-10-10 01:12] 0x208D9: ig it was around the time of win 8.1

[2024-10-10 01:14] Matti: yeah I hated windows 8.1 too

[2024-10-10 01:14] Matti: calc81.exe is only calc81.exe because that was the last version before they ditched the classic calculator

[2024-10-10 01:14] Matti: so it's most feature complete while still being usable

[2024-10-10 01:15] Matti: even on XP after some violence

[2024-10-10 01:16] 0x208D9: [replying to Matti: "even on XP after some violence"]
well u are lucky cuz xp is opensource

[2024-10-10 01:17] 0x208D9: search "nt5src.7z" in google

[2024-10-10 01:17] Matti: 1. no it isn't lol

[2024-10-10 01:17] Matti: 2. XP calc.exe != windows 8.1 calc.exe

[2024-10-10 01:17] 0x208D9: [replying to Matti: "1. no it isn't lol"]
i mean leaked but well :/

[2024-10-10 01:17] Matti: yes I know

[2024-10-10 01:17] Azrael: [replying to 0x208D9: "search "nt5src.7z" in google"]

[Attachments: image.png]

[2024-10-10 01:17] 0x208D9: [replying to Azrael: ""]
yes its basically that

[2024-10-10 01:18] Matti: look up the definition of open source, both of you

[2024-10-10 01:18] Azrael: I didn't even say anything?

[2024-10-10 01:18] 0x208D9: [replying to Matti: "look up the definition of open source, both of you"]
meant sarcastically ;-;

[2024-10-10 01:18] 0x208D9: ik

[2024-10-10 01:18] Matti: ok, one didn't say anything and the other was being sarcastic

[2024-10-10 01:18] Matti: good then

[2024-10-10 01:19] 0x208D9: [replying to Azrael: ""]
i miss msft ftp tho

[2024-10-10 01:19] 0x208D9: they apparently shut it down

[2024-10-10 01:19] Matti: [replying to Matti: "I do the same for mspaint, the snipping tool and a..."]
in case anyone wants these
[Attachments: return-to-sanity.7z]

[2024-10-10 01:20] Matti: I also have MS RDP from win 11, with the only difference being that it doesn't constantly moan at you when you get disconnected for entirely obvious reasons like shutting down the remote system

[2024-10-10 01:20] 0x208D9: idk wot that is but gonna check as soon as get back from vacation

[2024-10-10 01:20] Matti: but, that one is a clusterfuck

[2024-10-10 01:20] Matti: [replying to 0x208D9: "idk wot that is but gonna check as soon as get bac..."]
it might be malware

[2024-10-10 01:21] 0x208D9: [replying to Matti: "it might be malware"]
sounds like something i would fw

[2024-10-10 01:22] Matti: actually lemme fix that
[Attachments: return-to-sanity.7z]

[2024-10-10 01:22] Matti: signed so you know it was my malware

[2024-10-10 01:22] Matti: software

[2024-10-10 01:23] 0x208D9: i love discord cdn, thanks

[2024-10-10 08:29] mrexodia: [replying to Matti: "terminal is a poor clone of any unix shell, but sl..."]
Do you remember that epic paost of the terminal issues?

[2024-10-10 08:29] mrexodia: Some guy said 'it's slow'

[2024-10-10 08:29] mrexodia: Then the response from devs: 'you need a phd in rendering to make this fast'

[2024-10-10 08:29] mrexodia: The guy: 'I optimized it to be 1000x faster'

[2024-10-10 08:29] mrexodia: (he did not have a phd)

[2024-10-10 08:29] mrexodia: (probably patches never got merged)

[2024-10-10 08:49] brymko: was casey

[2024-10-10 08:49] brymko: he did like a repo of his thing

[2024-10-10 10:35] Rairii: [replying to Matti: "calc81.exe is only calc81.exe because that was the..."]
win32calc still exists in some editions, most notably server

[2024-10-10 10:36] Rairii: that might have changed since co though, i really dont care about windows 11 that much other than bindiffing the boot environment lol

[2024-10-10 10:37] Rairii: server 2022 definitely still has win32calc

[2024-10-10 16:16] Torph: [replying to Timmy: "fetchContent all the way"]
haha im still on git submodules

[2024-10-10 16:18] Torph: [replying to mrexodia: "The guy: 'I optimized it to be 1000x faster'"]
haha yeah that was pretty funny
it's so slow that my program flickers when it overwrites its own status line in the console @ 165fps

[2024-10-10 23:42] Matti: [replying to Rairii: "win32calc still exists in some editions, most nota..."]
checks out, it does still exist in some form in newer versions

[2024-10-10 23:42] Matti: even server 2025 preview still has it
[Attachments: image.png]

[2024-10-10 23:43] Matti: but I disagree with calling this `calc`, otherwise why didn't they name it calc.exe just like all of the other ones before them

[2024-10-10 23:43] Matti: """win32"""calc clearly implies there's a plan to replace it with the superiour UWP calc

[2024-10-10 23:43] Matti: aka calc

[2024-10-10 23:48] Rairii: win32calc is the internal package name, iirc

[2024-10-10 23:49] Matti: well that depends on the version of NT is what I'm saying

[2024-10-10 23:49] Matti: a lot of them never had a concept of packages to begin with

[2024-10-10 23:50] Matti: so yeah, I didn't think to search for "win32calc" when  finding the LKG version of calc.exe

[2024-10-10 23:53] Rairii: why would that matter, we're talking about things that happened after componentisation

[2024-10-10 23:54] Matti: wdym why would that matter
in those windows versions calc.exe already launched the shit version by default

[2024-10-10 23:54] Matti: is it really so crazy to assume that that means the original is just gone?

[2024-10-10 23:54] Matti: rather than renamed with a 'win32' prefix

[2024-10-10 23:55] Matti: actually, clarify 'componentization' as well

[2024-10-10 23:55] Matti: windows 8.1 can be componentized as well, surely

[2024-10-10 23:55] Matti: using dism

[2024-10-10 23:55] Rairii: yes, componentisation happened at vista

[2024-10-10 23:56] Matti: it just calls calc calc.exe

[2024-10-10 23:56] Matti: and Microsoft.Windows.Shell.calc in the resource directory boilerplate XML

[2024-10-10 23:56] Rairii: they renamed the original component, and added in a new one that's the stub calc.exe, and certain editions use one and other editions use the other

[2024-10-10 23:57] Rairii: https://pivotman319-owo.github.io/papers/windows%20cbs%20image%20assembly%20process%20-%20Final.pdf

[2024-10-10 23:58] Matti: oh
well I hope you'll forgive me for thinking that it's fairly insane to assume anyone would look for a *win32*calc.exe based on this

[2024-10-10 23:58] Matti: yeah I kow what CBS is

[2024-10-10 23:58] Matti: just wasnted to make sure we were talking about the same thing

[2024-10-10 23:58] Rairii: i think server 2022 has win32calc as calc.exe?

[2024-10-10 23:58] Matti: it has both filenames

[2024-10-10 23:58] Rairii: oh

[2024-10-10 23:58] Matti: but they are different files

[2024-10-10 23:59] Rairii: iirc my server 2022 installation has it as calc.exe, so yeah different editions etc

[2024-10-11 00:00] Matti: both 2022 and 2025 preview have both for me

[2024-10-11 00:00] Matti: one is standard, the other datacenter

[2024-10-11 00:01] Matti: idk what you're getting at really, my point was that... it's insane to expect someone to know this, or find it if they're used to running `calc`

[2024-10-11 00:01] Matti: seeing the new calc once is enough to make you want to uninstall the OS

[2024-10-11 00:01] Rairii: i got used to the new calc myself tbf

[2024-10-11 00:02] Rairii: the new notepad in win11 though...

[2024-10-11 00:02] Rairii: yeah fuck that

[2024-10-11 00:02] Matti: oh, that one is also in my 'revert-to-better' folder

[2024-10-11 00:02] Matti: sec

[2024-10-11 00:02] rin: whats wrong with new notepad

[2024-10-11 00:03] Rairii: yeah, at least the old one is still present

[2024-10-11 00:03] Matti: [replying to rin: "whats wrong with new notepad"]
it's dogshit slow

[2024-10-11 00:03] Rairii: i only have one test system running 11 though

[2024-10-11 00:03] rin: [replying to Matti: "it's dogshit slow"]
oh

[2024-10-11 00:03] Rairii: so never bothered fixing the file associations

[2024-10-11 00:03] Matti: the file associations are another thing yeah

[2024-10-11 00:04] Matti: mind blowingly dumb

[2024-10-11 00:04] Rairii: and the only reason i have that test system running 11

[2024-10-11 00:04] rin: what do you think of new terminal vs conhost

[2024-10-11 00:04] Rairii: is because its arm64 and thats when netfx port to arm64 got merged in

[2024-10-11 00:04] Matti: lol I think I already mentioned this same example above

[2024-10-11 00:04] Matti: cmd > terminal

[2024-10-11 00:05] Matti: I use a unix terminal if I want to use a real terminal

[2024-10-11 00:05] Matti: that isn't dogshit slow

[2024-10-11 00:06] rin: I don't do anything where I would notice a difference tbh.

[2024-10-11 00:06] Matti: <:wow:762710812904914945>

[2024-10-11 00:06] Matti: I'm unironically raging by the time terminal is done starting

[2024-10-11 00:07] Matti: it takes like a second

[2024-10-11 00:07] Matti: a full second

[2024-10-11 00:07] Matti: and not on a slow CPU either

[2024-10-11 00:07] rin: whats your pc like

[2024-10-11 00:07] Matti: 5950X, 128 GB RAM

[2024-10-11 00:07] Matti: notepad ^
[Attachments: notepad17763.7z]

[2024-10-11 00:08] rin: I have a 7800x3d and 32gb of ddr5

[2024-10-11 00:08] rin: I also notice a difference but its not huge

[2024-10-11 00:08] Matti: I'm uh, sensitive to latency I guess

[2024-10-11 00:09] Matti: I hate slow people too if that helps

[2024-10-11 00:09] Matti: like in the supermarket

[2024-10-11 00:09] Matti: why can't we just run them all over with a bus

[2024-10-11 00:09] rin: ...

[2024-10-11 00:10] Matti: I know I know

[2024-10-11 00:10] Matti: way too many people for 1 bus

[2024-10-11 00:10] Matti: but you could use an airplane

[2024-10-11 00:10] rin: I understand though, the new features should not justify a delay

[2024-10-11 00:10] Rairii: i wonder how much of uwp latency is because of com ipc

[2024-10-11 01:32] daax: [replying to Matti: "cmd > terminal"]
<:real:974467343289827378>

[2024-10-11 14:19] 0xboga: Is there a mechanism to signal a thread and pass some context to it ?  in windows kernel

[2024-10-11 14:19] 0xboga: not in the form APC

[2024-10-11 15:13] Matti: [replying to 0xboga: "Is there a mechanism to signal a thread and pass s..."]
1. pend an IRP without completing it, then complete when you wish to signal
2. send an ALPC message to a thread that's waiting for one (or alternatively in kernel mode only: has a callback configured for new ALPC messages)

[2024-10-11 15:14] Matti: (1) is a a very widely used model but kind of poorly understood (partially due to MS' documentation...)
it depends a bit on what you need to pass precisely but I'm pretty sure it's the best fit here

[2024-10-11 15:15] Matti: there is actually a WDK sample that showcases this technique, and some other ones for message passing

[2024-10-11 15:15] Matti: will see if I can find it, it's not exactly something with an obvious name from what I remember

[2024-10-11 15:16] Matti: there was also an OSR article on the same concept

[2024-10-11 15:18] Matti: scenario 4 in this article would be what I mean
https://learn.microsoft.com/en-us/windows-hardware/drivers/kernel/different-ways-of-handling-irps-cheat-sheet
[Embed: Different Ways of Handling IRPs - Cheat Sheet - Windows drivers]
Different ways of handling IRPs

[2024-10-11 15:19] Matti: (5 is the most straightforward but not always realistic 'just do it' method for handling IRPs, and you should ignore any scenarios after that because they're N/A here)

[2024-10-11 15:20] Matti: https://www.osronline.com/article.cfm%5Eid=21.htm is the OSR article I meant
[Embed: The NT Insider:Properly Pending IRPs - IRP Handling for the Rest o...]
OSR Open Systems Resources, Inc. The Windows device driver and file systems experts.  Seminars - Development - Consulting - Training

[2024-10-11 15:21] Matti: and https://www.osronline.com/article.cfm%5Earticle=214.htm is a complementary one that is just overal useful to have as reference
[Embed: The Basics:Rules for Irp Dispatching and Completion Routines]
OSR Open Systems Resources, Inc. The Windows device driver and file systems experts.  Seminars - Development - Consulting - Training

[2024-10-11 15:21] Matti: https://github.com/microsoft/Windows-driver-samples/tree/main/general/event and this is the sample
[Embed: Windows-driver-samples/general/event at main Â· microsoft/Windows-dr...]
This repo contains driver samples prepared for use with Microsoft Visual Studio and the Windows Driver Kit (WDK). It contains both Universal Windows Driver and desktop-only driver samples. - micros...

[2024-10-11 15:22] Matti: obviously "Pending IRP-based approach" is the one I mean here

[2024-10-11 15:23] Matti: I'm biased towards ALPC since I just know it has to be faster lol

[2024-10-11 15:23] Matti: but I wouldn't recommend using it in a real driver

[2024-10-11 15:24] Matti: due to the complete lack of documentation mainly

[2024-10-11 15:24] Matti: and I might still be wrong about it being faster too.... because that depends on many factors

[2024-10-11 15:25] Matti: if you are a kernel driver notifying a single user thread, pending an IRP will definitely be faster

[2024-10-11 15:55] 0xboga: Thanks!

[2024-10-11 16:53] JustMagic: [replying to 0xboga: "Is there a mechanism to signal a thread and pass s..."]
Can you explain a little more about what exactly you want, because it doesn't particularly make too much sense in context of kernel

[2024-10-11 16:54] Matti: the way I interpreted it was: he wants to signal/notify some thread, and additionally bundle some data with this (a 'message')

[2024-10-11 16:54] Matti: a pointer should be enough for that

[2024-10-11 16:54] Matti: but I suppose theoretically you can make larger IOCTLs for your IRPs if that's really desirable...

[2024-10-11 16:54] JustMagic: [replying to Matti: "the way I interpreted it was: he wants to signal/n..."]
Yeah but you usually don't have "threads" in kernel

[2024-10-11 16:55] Matti: nope

[2024-10-11 16:55] Matti: so that's why I guessed his driver is in kernel (well maybe that one is in a thread, idk) and he wants to notify a user mode thread

[2024-10-11 16:55] Matti: but yeah if not - please clarify

[2024-10-11 16:56] JustMagic: Like does he mean an actual kernel thread that needs to do work, some random suspension point in god knows where or a usermode thread that he wants to interrupt

[2024-10-11 16:57] Matti: well the latter seems the most logical/useful to me, hence the assumption....

[2024-10-11 16:57] Matti: but idk either

[2024-10-11 16:57] JustMagic: It's all based on the actual use case either way

[2024-10-11 16:57] JustMagic: Throughput and latency reqs

[2024-10-11 16:58] Matti: well yeah, but the way you phrase the question it pretty much comes down to: is it a normal use case or a retarded use case

[2024-10-11 16:58] Matti: if the second, reconsider maybe

[2024-10-11 17:29] 0xboga: [replying to JustMagic: "Can you explain a little more about what exactly y..."]
Sorry should have phrased it differently basically I have a UM thread waiting to be notified when a certain event is detected by my driver

[2024-10-11 17:30] JustMagic: [replying to 0xboga: "Sorry should have phrased it differently basically..."]
Then what Matti said is correct

[2024-10-11 17:31] JustMagic: Pend an IRP or use the filter communication port API (ALPC under the hood)

[2024-10-11 17:34] Windy Bug: [replying to 0xboga: "not in the form APC"]
Not that I think it matters now that youâ€™ve elaborated on the use case, but pending IOCTLs are completed asynchronously, so the I/O manager will use a special kernel APC to complete the requestâ€¦

[2024-10-11 17:47] Matti: heh, yeah that is true, I hadn't even thought of that

[2024-10-11 17:48] Matti: the ALPC callback for kernel mode threads (so N/A here, but just FYI) is also delivered via a special kernel APC)

[2024-10-11 17:48] Matti: in general I think returning pending is still worth it over queueing APCs yourself just because of how much code it is, and how error prone

[2024-10-11 17:49] Matti: assuming you want to do it correctly at least

[2024-10-11 17:50] Matti: but under water many (most?) things are secretly hacked around by the kernel using APCs when it suits

[2024-10-11 17:52] 0xboga: My thread runs with the ApcQueueable bit off , will it block the special apc?

[2024-10-11 17:53] Matti: uhm I'm not familiar with that particular flag but assuming it's named correctly....

[2024-10-11 17:53] Matti: well

[2024-10-11 17:53] Matti: you know

[2024-10-11 17:54] 0xboga: I think Iâ€™ve read once special ignore the flag, unlike regular kernel apcs but Iâ€™m not sure

[2024-10-11 17:55] Matti: yeah that is certainly possible

[2024-10-11 17:55] Matti: and then they've not named it very well

[2024-10-11 17:56] Matti: special kernel APCs are special because they get to go more often than normal kernel APCs (and first too I presume, if it matters)

[2024-10-11 17:57] Matti: if you weren't getting special KAPCs, most of what the I/O manager does in regular file I/O syscalls would hang your thread

[2024-10-11 17:57] Matti: e.g. NtReadFile

[2024-10-11 17:58] Matti: historically this worked differently, with an APC disable 'count', which wasn't really any easier to understand

[2024-10-11 17:59] Matti: but so now they've got one bit to disable regular APCs I guess?

[2024-10-11 17:59] Matti: no twin for special APCs next to it?

[2024-10-11 18:00] Matti: either way as long as your thread can have special kernel APCs queued to it, most if not all of what relates to iomgr will continue to work with no difference

[2024-10-11 18:01] Matti: but the same is not true for your user  mode thread

[2024-10-11 18:01] Matti: so fortunately it can't set this bit <:thinknow:475800595110821888>

[2024-10-11 18:02] 0xboga: [replying to Matti: "the ALPC callback for kernel mode threads (so N/A ..."]
Just curious, why an apc is required for a callback?

[2024-10-11 18:03] Matti: well, this callback is invoked in the same thread context of the thread that sent the message that originally caused the ALPC notification

[2024-10-11 18:04] 0xboga: Oh

[2024-10-11 18:04] Matti: since the kernel driver can be put in the same thread context this way, it's almost like 1 thread talking to itself

[2024-10-11 18:04] Matti: which is pretty fast as you can imagine

[2024-10-11 18:04] 0xboga: Cool, thanks everyone!

[2024-10-11 18:11] donnaðŸ¤¯: [replying to 0xboga: "Sorry should have phrased it differently basically..."]
https://www.osr.com/nt-insider/2013-issue1/inverted-call-model-kmdf/
[Embed: The Inverted Call Model in KMDF]
The example driver and test app accompanying this article can be found in OSRâ€™s GitHub repo at One of the most common questions we see from students, clients, and new Windows driver writing câ€¦

[2024-10-11 18:15] Matti: [replying to donnaðŸ¤¯: "https://www.osr.com/nt-insider/2013-issue1/inverte..."]
ahh thanks!
this was the article I *actually* was thinking of, only this is the more modern and KMDF-ized version with a fancy name

[2024-10-11 18:16] Matti: the one I actually actually was thinking of would be https://www.osronline.com/article.cfm%5eid=94.htm
[Embed: The NT Insider:Kernel: Calling User Mode - Using the Inverted Call...]
OSR Open Systems Resources, Inc. The Windows device driver and file systems experts.  Seminars - Development - Consulting - Training

[2024-10-11 18:17] Matti: ok disregard that last bit, they've apparently always called it the inverted call model <:lillullmoa:475778601141403648> that does explain why it was so hard to find

[2024-10-11 18:18] Matti: but yeah all of these articles including the MS documentation re: scenario #4 and the WDK sample, basically do the same thing

[2024-10-11 18:18] Matti: it works very well but it's not intuitive for most people

[2024-10-11 18:21] donnaðŸ¤¯: [replying to Matti: "ahh thanks!
this was the article I *actually* was ..."]
There is another article here: https://www.osronline.com/article.cfm%5Eid=94.htm (though quite old) but explains it using the non wdf (forget the name)
[Embed: The NT Insider:Kernel: Calling User Mode - Using the Inverted Call...]
OSR Open Systems Resources, Inc. The Windows device driver and file systems experts.  Seminars - Development - Consulting - Training

[2024-10-11 18:22] Matti: yep, that's the one I linked

[2024-10-11 18:22] donnaðŸ¤¯: but yea inverted call model is really cool - pairing it with a completion port also allows for queueing of multiple irps then using something like a hashmap for the handle -> buffer

[2024-10-11 18:22] donnaðŸ¤¯: [replying to Matti: "yep, that's the one I linked"]
ah my bad missed it

[2024-10-11 18:22] donnaðŸ¤¯: i am so blind

[2024-10-11 18:22] donnaðŸ¤¯: ðŸ˜‚

[2024-10-11 18:23] Matti: well np, it's not such a bad link to have a few too many of

[2024-10-11 18:23] Matti: since not many people are aware of how well it works and how simple it is

[2024-10-11 18:23] Matti: [replying to donnaðŸ¤¯: "but yea inverted call model is really cool - pairi..."]
e.g. to do things like this

[2024-10-11 18:24] Matti: it's only not *intuitive* (at least for me) in that I doubt I would've come up with this myself

[2024-10-11 18:24] donnaðŸ¤¯: yea its pretty neat